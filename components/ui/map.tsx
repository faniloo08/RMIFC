// components/ChoroplethMap.tsx
import { MapContainer, TileLayer, GeoJSON } from 'react-leaflet';
import 'leaflet/dist/leaflet.css';
import L from 'leaflet';
import { useEffect, useState } from 'react';

// Fix default icon issue in Leaflet when using it with React
delete (L.Icon.Default.prototype as any)._getIconUrl;

L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png',
  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
});

// Define your GeoJSON data
const geojsonData = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            [
              [
                38.306367855175864,
                -5.458209677979937
              ],
              [
                41.300018810285394,
                -14.27778588588717
              ],
              [
                35.883608945733414,
                -27.414629378839365
              ],
              [
                18.762348164162006,
                -65.24038047624143
              ],
              [
                51.45899717242773,
                -63.289638904667726
              ],
              [
                124.0524947445586,
                -62.83904456015023
              ],
              [
                138.27875071201936,
                -41.501566475709176
              ],
              [
                112.78400605833946,
                -31.248130217169063
              ],
              [
                124.72516969190923,
                -17.90631853909528
              ],
              [
                108.84909408475346,
                -10.344288207234541
              ],
              [
                94.2294455123436,
                4.5380816244141045
              ],
              [
                75.67528289487024,
                8.697935867413065
              ],
              [
                72.39702912847122,
                20.349093248619283
              ],
              [
                62.52260256217974,
                25.112363067767873
              ],
              [
                55.23703112524291,
                16.790142452814038
              ],
              [
                50.78703841043185,
                9.912217286430959
              ],
              [
                38.306367855175864,
                -5.458209677979937
              ]
            ]
          ],
          "type": "Polygon"
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                46.29997510874131,
                -11.855396292819217
              ],
              [
                45.610515461305496,
                -11.887466111177007
              ],
              [
                44.92711173788079,
                -11.983389308591075
              ],
              [
                44.25577355469171,
                -12.142309669710938
              ],
              [
                43.6024186424153,
                -12.362808629006024
              ],
              [
                42.972828662044435,
                -12.642917737573459
              ],
              [
                42.37260695120204,
                -12.980135689514167
              ],
              [
                41.80713856215861,
                -13.371449524169524
              ],
              [
                41.281552744304236,
                -13.813359568538024
              ],
              [
                40.80068780113842,
                -14.301907668287862
              ],
              [
                40.36905803502564,
                -14.832708276970031
              ],
              [
                39.99082230194081,
                -15.400982029311383
              ],
              [
                39.66975355180106,
                -16.001591511020933
              ],
              [
                39.40920864418258,
                -16.62907904714088
              ],
              [
                39.21209771795073,
                -17.277706454397414
              ],
              [
                39.08085246715067,
                -17.94149682950014
              ],
              [
                39.01739284142056,
                -18.61427856304415
              ],
              [
                39.02309194999801,
                -19.289731865035414
              ],
              [
                39.098739301652664,
                -19.961438150308464
              ],
              [
                39.244502949413075,
                -20.62293264779847
              ],
              [
                39.45989161099009,
                -21.267760555472698
              ],
              [
                39.74371837503142,
                -21.889536953657338
              ],
              [
                40.09406813949525,
                -22.48201050811513
              ],
              [
                40.508271409025156,
                -23.039130740495562
              ],
              [
                40.98288744043945,
                -23.555118324794
              ],
              [
                41.51369990095806,
                -24.02453749998932
              ],
              [
                42.09572812675767,
                -24.44236929633923
              ],
              [
                42.723256687667444,
                -24.80408389020253
              ],
              [
                43.38988525149268,
                -25.10571007094573
              ],
              [
                44.088599711226664,
                -25.343899567535896
              ],
              [
                44.81186424951082,
                -25.51598388293444
              ],
              [
                45.551732573837604,
                -25.620021352754165
              ],
              [
                46.29997510874131,
                -25.65483239587758
              ],
              [
                47.048217643645,
                -25.620021352754165
              ],
              [
                47.78808596797179,
                -25.51598388293444
              ],
              [
                48.51135050625595,
                -25.3438995675359
              ],
              [
                49.210064965989936,
                -25.10571007094573
              ],
              [
                49.876693529815164,
                -24.80408389020253
              ],
              [
                50.50422209072495,
                -24.44236929633923
              ],
              [
                51.08625031652454,
                -24.02453749998932
              ],
              [
                51.61706277704317,
                -23.555118324794
              ],
              [
                52.091678808457445,
                -23.039130740495562
              ],
              [
                52.50588207798736,
                -22.48201050811513
              ],
              [
                52.85623184245118,
                -21.88953695365734
              ],
              [
                53.140058606492516,
                -21.267760555472698
              ],
              [
                53.35544726806954,
                -20.62293264779847
              ],
              [
                53.501210915829944,
                -19.961438150308467
              ],
              [
                53.5768582674846,
                -19.289731865035414
              ],
              [
                53.582557376062056,
                -18.61427856304415
              ],
              [
                53.51909775033194,
                -17.941496829500142
              ],
              [
                53.38785249953188,
                -17.277706454397414
              ],
              [
                53.19074157330003,
                -16.62907904714088
              ],
              [
                52.93019666568156,
                -16.00159151102093
              ],
              [
                52.6091279155418,
                -15.400982029311383
              ],
              [
                52.23089218245698,
                -14.832708276970035
              ],
              [
                51.79926241634419,
                -14.301907668287862
              ],
              [
                51.31839747317837,
                -13.813359568538027
              ],
              [
                50.79281165532401,
                -13.371449524169526
              ],
              [
                50.22734326628058,
                -12.980135689514167
              ],
              [
                49.62712155543817,
                -12.642917737573459
              ],
              [
                48.99753157506731,
                -12.362808629006024
              ],
              [
                48.34417666279091,
                -12.142309669710942
              ],
              [
                47.67283847960183,
                -11.983389308591075
              ],
              [
                46.98943475617711,
                -11.887466111177007
              ],
              [
                46.29997510874131,
                -11.855396292819217
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {},
        "geometry": {
          "coordinates": [
            47.54938983459215,
            -18.861232292271623
          ],
          "type": "Point"
        }
    }
    ]
  };

const Map = () => {
  const [geojson, setGeojson] = useState<any>(null);

  useEffect(() => {
    setGeojson(geojsonData);
  }, []);

  const getColor = (d: number) => {
    return d > 1000 ? '#800026' :
           d > 500  ? '#BD0026' :
           d > 200  ? '#E31A1C' :
           d > 100  ? '#FC4E2A' :
           d > 50   ? '#FD8D3C' :
           d > 20   ? '#FEB24C' :
           d > 10   ? '#FED976' :
                      '#FFEDA0';
  }

  const style = (feature: any) => {
    return {
      fillColor: getColor(feature.properties.density),
      weight: 2,
      opacity: 1,
      color: 'white',
      dashArray: '3',
      fillOpacity: 0.5
    };
  }

  return (
    <div className="2xl:w-[100%] 2xl:ml-[-30px]">
        <MapContainer
        center={[-20.0, 60.0]} // Center the map to the Indian Ocean
        zoom={5}
        style={{ borderRadius: '20px', boxShadow:'6px 6px 10px 0px rgba(0, 0, 0, 0.4)'}}
        className="h-[150px] w-[450px] md:w-[90%] lg:w-[90%] xl:w-[100%] ">
        <TileLayer
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        />
        {geojson && (
            <GeoJSON data={geojson} style={style} />
        )}
        </MapContainer>
    </div>

  );
};

export default Map;
